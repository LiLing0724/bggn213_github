---
title: "Class09: Structural Bioinformatics pt1."
author: "Li Ling(A15092789)"
format: pdf
---
##The PDB database

The main repository for biomolecular structure data is the Protein Data Bank (PDB) https://www.rcsb.org/

Let's have a quick look at the composition of this database:


```{r}
# Save your input data file into your Project directory
# Complete the following code to input the data and store as wisc.df
stats <- read.csv("PDB.csv", row.names=1)

stats
```


> Q1: What percentage of structures in the PDB are solved by X-Ray and Electron Microscopy.

```{r}
X.ray <- as.numeric(sub(",","",stats$X.ray))
EM <- as.numeric(sub(",","",stats$EM))
Total <- as.numeric(sub(",","",stats$Total))
```

This is annoying, let's try another import function from the **readr** package.

```{r}
library(readr)

stats <- read_csv("PDB.csv")
stats
```
Percent Xray
```{r}
n.total <-sum(stats$Total)
n.xray <- sum(stats$'X-ray')
n.em <- sum(stats$EM)

round(n.xray/n.total * 100, 2)
round(n.em/n.total * 100, 2)
```

> Q2: What proportion of structures in the PDB are protein only?

```{r}
stats$Total[1]/sum(stats$Total) * 100
```

> Q2b: Make a bar plot overview of Molecular type composition using ggplot2.

```{r}
library(ggplot2)

ggplot(stats, aes(x=reorder(`Molecular Type`,-Total), Total)) +
  geom_bar(stat="identity") +
  labs(title="PDB Molecular Type Overview",
       x="Molecular Type",
       y="Number of Structures")
```

##Visualizing structure data

The Mol* viewer is embedded in many bioinformatics websites. https://molstar.org/viewer/

PDB ID: 1HSG

I can insert any figure or image file using markdown format

![The HIV-Pr dimer with bound inhibitor](1HSG.png)


> Q3: Type HIV in the PDB website search box on the home page and determine how many HIV-1 protease structures are in the current PDB?

According to the websites, there are 4,866 structures found for "HIV-1 protease".


> Q4: Water molecules normally have 3 atoms. Why do we see just one atom per water molecule in this structure?

Why not presenting H atoms but only O atom. Because only the oxygen is experimentally located — the two hydrogens are implied, not directly observed.

![Water above the two ASP25](1HSG_ASP.png)
![Molecular Surface](1HSG_SURFACE.png)

##Bio3D package for structural bioinformatics

We can use the Bio3D package to read and analyze biomolecular data in R:

```{r}
library(bio3d)
hiv <-read.pdb("1hsg")
hiv

```

```{r}
head(hiv$atom)
```

Let's get the sequence

```{r}
pdbseq(hiv) #for both chaim A and B
```

Let's trim it to chain A and get just it's sequence.

```{r}
chainA<-trim.pdb(hiv, chain="A")
chainA.seq <- pdbseq(chainA)
```

Let's blast

```{r blast_hiv, cache=TRUE}

blast <- blast.pdb(chainA.seq)
```

```{r}
head(blast$hit.tbl)
```

Plot a quick overview of the blast results

```{r}
hits <- plot(blast)
```

```{r}
hits$pdb.id #accession number from the results
```

##Prediction of funtional motions

We can ran on Normal Mode Analysis (NMA)to predict large scale motions/flexibility/dynamics of any biomolecule that we can read into R.

Let's look at ADK chain A only!

```{r}
adk <- read.pdb("1ake")

adk_A <- trim.pdb(adk, chain="A")
adk_A
```

```{r}
m <- nma(adk_A)
plot(m)
```

Let's write out a "trajectory" of predicted motion

```{r}
mktrj(m, file="adk_nma.pdb")
```

## Play with 3D viewing in R

We can use the new **bio3dview** package, which is not yet on CRAN, to render interacting 3D views in R and HTML quanto output reports.

To install from GitHub we can use the **pak** package.

```{r}
library(bio3dview)

view.pdb(adk)
```



> Q5: There is a critical “conserved” water molecule in the binding site. Can you identify this water molecule? What residue number does this water molecule have?

```{r}

```


> Q6: Generate and save a figure clearly showing the two distinct chains of HIV-protease along with the ligand. You might also consider showing the catalytic residues ASP 25 in each chain and the critical water (we recommend “Ball & Stick” for these side-chains). Add this figure to your Quarto document.

```{r}

```


> Q7: How many amino acid residues are there in this pdb object? 

```{r}

```


> Q8: Name one of the two non-protein residues? 

```{r}

```


> Q9: How many protein chains are in this structure? 

```{r}

```


> Q10. Which of the packages above is found only on BioConductor and not CRAN? 

```{r}

```


> Q11. Which of the above packages is not found on BioConductor or CRAN?: 

```{r}

```


> Q12. True or False? Functions from the devtools package can be used to install packages from GitHub and BitBucket? 

```{r}

```


> Q13. How many amino acids are in this sequence, i.e. how long is this sequence?

```{r}

```


> Q14. What do you note about this plot? Are the black and colored lines similar or different? Where do you think they differ most and why?

```{r}

```

## Comparative analysis of protein structure
Starting with a sequence or structure ID (accession number), let's run a complete analysis pipeline.

```{r}
library(bio3d)

id <- "1ake_A"

aa <- get.seq(id)

aa
```

```{r, cache=TRUE}
blast <- blast.pdb(aa)

hits <- plot(blast)
```


```{r}
hits$pdb.id 
```

Download all these "hits" that are similar to our starting id sequence.
```{r}
# Download releated PDB files
files <- get.pdb(hits$pdb.id, path="pdbs", split=TRUE, gzip=TRUE)
```

```{r}
# Align releated PDBs
pdbs <- pdbaln(files, fit = TRUE, exefile="msa")
```

```{r}
pc.xray <- pca(pdbs)
plot(pc.xray)
```

```{r}
plot(pc.xray, 1:2)
```

```{r}
mktrj(pc.xray, file="pca_results.pdb")
```


```{r}
library(bio3dview)

view.pca(pc.xray)
```

























